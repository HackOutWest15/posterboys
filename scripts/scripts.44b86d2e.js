"use strict";angular.module("posterboyApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","spotify","colorpicker.module"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode(!1).hashPrefix("!")}]),angular.module("posterboyApp").service("echonestApiService",["$q","$http",function(a,b){var c=this;c.apiKey="FO7DBKI3Y5L8P4DGY",c.baseUrl="https://developer.echonest.com/api/v4/",c.getArtistImages=function(a){return b({method:"GET",url:c.baseUrl+"artist/images?api_key="+c.apiKey+"&id=spotify:artist:"+a})},c._getRandomImage=function(a){var b=a.data.response.images,c=Math.floor(Math.random()*b.length);return b[c]},c.getRandomArtistImage=function(b){var d=a.defer();return c.getArtistImages(b).then(function(a){if(200==a.status&&a.data.response.images){var b=c._getRandomImage(a);d.resolve(b.url)}}),d.promise}}]),angular.module("posterboyApp").controller("MainCtrl",["$q","MusixService","Spotify","echonestApiService",function(a,b,c,d){var e=this;e.STEP_CREATE=0,e.STEP_CUSTOMIZE=1,e.STEP_SAVE=2,e.step=0,e.isLoading=!1,e.poster={lyrics:["Iâ€™m living the future so the present is my past"],quoteIndex:0,artist:"Kanye West",track:"Monster",artistImageUrl:"http://uptownmagazine.com/files/2015/01/People-Kanye_West.jpg",showArtist:!0,showTitle:!0,showBorder:!0,fontSize:4,quoteFontFamily:"Oswald",artistTitleFontFamily:"Oswald",bgTint:"rgba(0, 0, 0, 0.65)"},e.quoteNext=function(){e.poster.quoteIndex+1<e.poster.lyrics.length&&(e.poster.quoteIndex=e.poster.quoteIndex+1)},e.quotePrev=function(){e.poster.quoteIndex-1>=0&&(e.poster.quoteIndex=e.poster.quoteIndex-1)},e.changeImage=function(){e.isLoading=!0,d.getRandomArtistImage(e.poster.artistId).then(function(a){e.poster.artistImageUrl=a}),e.isLoading=!1},e.loadingPoster={},e.getInfo=function(f,g){e.isLoading=!0,f=f.split(":").slice(-1)[0].split("/").slice(-1)[0];var h=c.getTrack(f),i=b.getMusixId(f);a.all([h,i]).then(function(c){e.loadingPoster.track=c[0].name,e.loadingPoster.artist=c[0].artists[0].name,e.loadingPoster.artistId=c[0].artists[0].id;var f,h=d.getRandomArtistImage(e.loadingPoster.artistId);if(c[1]&&c[1].data&&c[1].data.response&&c[1].data.response.songs){var i=c[1].data.response.songs[0].foreign_ids[0].foreign_id.split(":").slice(-1)[0];f=b.getLyrics(i)}a.all([h,f]).then(function(a){e.loadingPoster.artistImageUrl=a[0],a[1]&&a[1].data&&a[1].data.message&&a[1].data.message.body&&a[1].data.message.body.lyrics?e.loadingPoster.lyrics=a[1].data.message.body.lyrics.lyrics_body.match(/[^\r\n]+/g):console.log("error parsing lyric response: "+a[1]),e.poster.track=e.loadingPoster.track,e.poster.artist=e.loadingPoster.artist,e.poster.artistId=e.loadingPoster.artistId,e.poster.artistImageUrl=e.loadingPoster.artistImageUrl,e.poster.lyrics=e.loadingPoster.lyrics,g?e.poster.quoteIndex=g:e.poster.quoteIndex=0,e.isLoading=!1})})},e.generateImg=function(a){var b=document.getElementById("poster");angular.element(b).addClass("format-"+a),window.html2canvas(b,{allowTaint:!0,logging:!0,proxy:"https://immense-ridge-3213.herokuapp.com/proxy.php"}).then(function(c){var d=window.open();d.document.write('<canvas id="poster" width="'+c.width+'" height="'+c.height+'"></canvas>');var f=d.document.getElementById("poster"),g=f.getContext("2d");g.drawImage(c,0,0),angular.element(b).removeClass("format-"+a),console.log(e)},function(){window.alert("An error occured!")})}}]),angular.module("posterboyApp").service("MusixService",["$http",function(a){var b=this,c="VOEYVDVQ84HIHMU04";b.getMusixId=function(b){return a.get("http://developer.echonest.com/api/v4/song/profile?api_key="+c+"&format=json&track_id=spotify:track:"+b+"&bucket=id:musixmatch-WW")},b.getLyrics=function(b){var c="http://api.musixmatch.com/ws/1.1/track.lyrics.get?format=jsonp&callback=JSON_CALLBACK&apikey=6929f9543219d0a92f18a3a088f19000&track_id=";return a.jsonp(c+b)}}]);